-*- mode: org; -*-

* версия 7.0 [0%][0/0]

** must:   
*** TODO преобразование адресов из конверта [[http://bugs.drweb.com/bug_view_advanced_page.php?bug_id=37460][(37460]])
*** TODO SSl/TLS ([[http://bugs.drweb.com/bug_view_advanced_page.php?bug_id%3D13949][13949]])
*** TODO параметры пользователя/группы могут не сработать если в письме несколько получателей
*** TODO DKIM/DomainKeys ([[http://bugs.drweb.com/bug_view_advanced_page.php?bug_id=37463][37463]])
*** TODO SPF ([[http://bugs.drweb.com/bug_view_advanced_page.php?bug_id=37461][37461)]]
*** TODO URL Filtering ([[http://bugs.drweb.com/bug_view_advanced_page.php?bug_id=37464][37464]])
*** TODO filter on certain types of files ([[http://bugs.drweb.com/bug_view_advanced_page.php?bug_id=37465][37465]])
*** TODO compliance/outbound content control ([[http://bugs.drweb.com/bug_view_advanced_page.php?bug_id=37466][37466]])
*** TODO attachments: identify different types ([[http://bugs.drweb.com/bug_view_advanced_page.php?bug_id=28001][28001]])


** want:
*** TODO взаимодействие между различными MailD (GEN-005)
*** TODO Greylisting ([[http://bugs.drweb.com/bug_view_advanced_page.php?bug_id=34917][34917]])
*** TODO добавить поддержку Recipient Callout Verification ([[http://bugs.drweb.com/bug_view_advanced_page.php?bug_id=0047075][47075]])

* осталось с версии 6.0

** DONE совмещение файлового карантина со внутренней БД. Конверт перемещается в
  карантин - там же хранится id сообщения, время помещения в карантин,
  уникальный идентификатор Клиента. возможно так же тема сообщения. Тело
  сообщения хранится в каталогах. позволяет ввести ограничения для карантина:
  - максимальный размер (по каждому из Клиентов)
  - максимальное время хранения сообщения в карантине (уже реализовано)
  - максимальное число сообщений в карантине (по каждому из Клиентов)
  Так же это позволяет производить индексацию и быстрый поиск по каждому из
  полей в БД. Добавление новых управляющих команд в control
  socket. drweb-qcontrol теперь управляет только карантином в DBI (возможно
  потом добавить взаимодействие с control socket`ом).

** DONE rules сейчас не справятся с огромным числом личных пользовательских
  настроек, так как их поиск сейчас имеет сложность O(n). Надо
  добавить расширение, с целью поиска пользовательских настроек в
  правилах по почтовому адресу со сложностью O(log n), а еще лучше
  O(1). Реализовать это через внутреннюю БД. Интерфейс управления -
  через control socket (возможно и отдельную утилиту командной строки
  надо).

** DONE получение через управляющий сокет MailD информации по статистике (с
  целью поддержки потом статистики в веб-интерфесах).

** DONE интеграция новой либы на основе  boost::asio в drweb-receiver - с
  целью повысить поддержку максимального числа smtp-соединений,
  повысить производительность

** DONE новые действия на управляющем сокете:
   - reload/stop
   -  send and remove msgs from db (atomic operation)

** DONE комментарии в utf8
** DONE переименование namespaces (IPC -> ipc, MailDaemon -> maild, DrWeb -> drweb)
** TODO новые действия на управляющем сокете:
   - экспорт/импорт в xml информации из БД
     
** TODO новый mail-парсер. см [[Приложение%201.][приложение]]
** TODO переход на boost::spirit 2.2   


* осталось с версии 5.0

** DONE Добавить статистику по найденному спаму в плагин vaderetro.
** TODO Возможность передачи всего сообщения и разобранных частей в shared
   memory. Это очень большая работа, но она позволит резко поднять
   производительность (возможно даже удасться превзойти старые
   фильтры). Потребует модификации демона и протокола взаимодействия с
   целью возможности проверки данных в shared memory. Скорее всего
   потребует изменения обоих наших API.

** TODO Улучшения в плагине drweb: more actions: PasswordProtectedArchive,
  MultipartArchive, UnpackingError etc



* Приложение 1. 
Новый mail-парсер:
======================================================================

Все возможности mimepp, который используются в версии MailD 5.0 должны
быть сохранены.

По сравнению со старым должны быть следующие преимущества:

- производительность: за счет активного использования
  boost::iterator_range и соответствующих алгоритмов из boost, а так
  же минимизации числа временных строковых переменных, создаваемых в
  процессе работы, значительно уменьшить число необходимых выделений
  памяти

- более строгое соответствие rfc5322 - возможность в парсере указывать
  степень допустимых ошибок в письме. настраиваемое распознование не
  соответствия письма rfc - расширенная система распознования ошибок

- настраиваемая поддержка лога - с четким выводом разобранной
  mime-структуры сообщения

- исправить проблемы при пересборки сообщения: порча электронной подписи,
  аттачей и т.п.

- возможность разбора сообщения по мере его поступления - с
  возможностью узнать текущий статус разобранной части сообщения
  (разобраны все заголовки, разобрана 3 mime-часть)

- возможность разобрать только необходимую часть сообщения (например,
  заголовки, 2-mime часть и т.п.)

- возможность не хранить у себя копию всего сообщения, а использовать
  внешнее хранилище (например разбирать сообщение, находящееся в
  shared-memory без создания его полной копии).

- возможность ограничить вложенность mime-частей а так же общее число
  mime-частей (#25601)

- библиотека должна полностью соответствовать Boost Developer Guidelines
(
https://svn.boost.org/trac/boost/wiki/Guidelines/MaintenanceGuidelines#DeveloperGuidelines
) - в этом случае поддержку лога видимо придется из нее убрать.

